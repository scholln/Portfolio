---
title: "The_RMD_MonteCarlo"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)



library(shiny)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:




Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r Now its time to get funky}

ICD_10_accuracy <- full_synthetic %>%
  select('Member ID (secure)', memb_brth_dt.x, memb_gender_cd.x, patient_name, state_nm, allwd_amt.x, princ_icd10_diag_cd, admtng_icd10_diag_cd)
  
view(ICD_10_accuracy)

```


```{r function to check accurarcy}

# accuracy <- function(data_set, col_name1, col_name2)
#   {
#   
#   if((data_set$col_name1) == (data_set$col_name2)){
#     
#     mutate(data_set, Accurate = 1)
#   }
#   else{
#     mutate(data_set, Accurate = 0)
#   }
#   
#     
#   
#   
# }
# 
# accuracy(ICD_10_accuracy, princ_icd10_diag_cd, admtng_icd10_diag_cd)


ICD_10_accuracy %>%
  mutate(accurate = if_else(princ_icd10_diag_cd == admtng_icd10_diag_cd, 1, 0)) %>%
  filter(!is.na(accurate))


```

Holy smokes that was a huge bust, there were no cases where the admitting ICD10 and the diagnosis ICD10 where the same.  Either they had an NA or did not match



```{r We get up and try again}

Amount_allowed <- full_synthetic %>%
  select(princ_icd10_diag_cd, "Member ID (secure)",  memb_brth_dt.x, memb_gender_cd.x, patient_name, state_nm, allwd_amt.x, sbmtd_amt.x, copay_coin_amt, coin_amt, ded_amt)
  

Diag_amount_allowed <- Amount_allowed %>%
  group_by(princ_icd10_diag_cd) %>%
  summarise(mean = mean(allwd_amt.x, na.rm = TRUE), sd = sd(allwd_amt.x, na.rm = TRUE), n = n())

```




```{r function time}


## I found that this produced a huge dataset that was unusable due to too many NA's.  Many entries in the diagnosis had nothing but NA's, we couldn't get an accurate picture of it with so many entries with NA's.  That, and some entries had only one value to return.

map2(Diag_amount_allowed$mean, Diag_amount_allowed$sd, ~rnorm(100, .x, .y))
```




```{r Let's change gears and do MLM}

model <- lm(ded_amt~allwd_amt.x+sbmtd_amt.x+copay_coin_amt+coin_amt, Amount_allowed)

```

```{r Print the model to check}

print(model)

```

```{r Let's try a formula}

deductible <- function(allwd_amt, sbtd_amt, copay_coin_amt, coin_amt){
  
  deductible = 22.95425 + (allwd_amt * 804.88442) + (sbtd_amt * -784.75091) + (copay_coin_amt * -0.02612) + (coin_amt * 0.72997)
  
  return(deductible)
}

```

```{r Testing it out}



deductible(5000, 2000, 200, 500)


```

```{r We are going to explore further into the Original dataset}

Location <- full_synthetic2 %>%
  select(memb_brth_dt.x, memb_gender_cd.x, memb_rltnshp_cd, patient_name, state_nm, county_nm, country, address, mbrs_crnt_prim_zip_cd)

```


```{r Seeing patient location}

Location %>%
  group_by(state_nm) %>%
  ggplot(aes(county_nm, fill = state_nm)) +
  geom_bar()



```

